name: Mytv Build Pipeline

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main" ]

# Botun depoya yazabilmesi için bu blok şart dayı
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Depoyu Çekme
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Tüm geçmişi çekmek push hatalarını önler

      # 2. Ortam Hazırlama
      - name: Set up Environment
        run: echo "Ortam hazırlanıyor..."

      # 3. Build İşlemi (Buraya kendi build komutlarını ekleyebilirsin)
      - name: Build Project
        run: |
          echo "Build işlemi başlatıldı: UmayTrade/Mytv"
          # Örnek: Dosyaları 'builds' klasörüne topladığını varsayalım
          mkdir -p builds
          cp *.cs3 builds/ 2>/dev/null || true
          cp plugins.json builds/ 2>/dev/null || true

      # 4. Build Dosyalarını 'builds' Branch'ine Push Etme
      - name: Deploy to Builds Branch
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # 'builds' adında bir klasöre girip orayı yeni bir repo gibi başlatıyoruz
          cd builds
          git init
          git add .
          git commit -m "Build ${{ github.sha }}"
          
          # Mevcut GITHUB_TOKEN ile yetkilendirilmiş URL üzerinden zorlayarak push yapıyoruz
          git push --force "https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" HEAD:builds
